---
title: sudo
tags:
  - sudo
categories:
  - 命令行工具
date: 2017-08-23 15:39:23
---



## 查看

```bash
sudo -ll # 显示当前sudo配置
sudo -lU user # 查看某个特定用户的设置
```

## 使用 visudo 修改

> /etc/sudoers 格式错误会导致 sudo 不可用，因此必须使用 visudo 编辑该文件防止出错。

```bash
EDITOR=vim visudo # 可以指定其他编辑器
```

## 配置

允许某用户可以执行所有命令

```bash
用户名 ALL=(ALL) ALL
deploy ALL=(ALL) NOPASSWD: ALL # 无需密码
```

只允许以某个**主机名**登录用户执行命令

```bash
用户名 主机名=(ALL) ALL
```

允许用户组成员无密码使用sudo

```bash
%组名 ALL=(ALL) NOPASSWD: ALL
```

不询问某个用户的密码

```bash
Defaults:用户 !authenticate
```

只为用户启用部分命令的执行权限


```bash
用户名 主机名=/sbin/halt/,/sbin/poweroff,/sbin/reboot -Syu
用户名 主机名= NOPASSWD: /sbin/halt/,/sbin/poweroff,/sbin/reboot -Syu # 不用输入密码
```

### 密码有效时间


```bash
Defaults:用户名 timestamp_timeout=20 # 20分钟内不需要输入密码
Defaults:用户名 timestamp_timeout=0  # 0 总是询问密码
```

### -E 选项

当前用户的环境变量不会应用到sudo启动的程序，除非使用 -E 选项


```bash
sudo -E ...
```

### sudo 与重定向


```bash
sudo sh -c 'echo xxx > /etc/xxx'
echo xxx > sudo tee /etc/xxx
```

