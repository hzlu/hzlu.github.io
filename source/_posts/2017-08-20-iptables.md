---
title: iptables
tags:
  - iptables
categories:
  - 命令行工具
date: 2017-08-20 21:54:17
---



## 显示当前规则

```sh
iptables -vnL
iptables -vnL --line-numbers # 添加行号
```

## 重置规则

```sh
iptables -F # 刷新所有链
iptables -X # 删除所有非默认链
iptables -t nat -F # -t 指定表的链
iptables -t nat -X
iptables -t mangle -F
iptables -t mangle -X
iptables -t raw -F
iptables -t raw -X
iptables -t security -F
iptables -t security -X
iptables -P INPUT ACCEPT # INPUT 链上的默认规则为 ACCEPT
iptables -P FORWARD ACCEPT
iptables -P OUTPUT ACCEPT
```

## 编辑规则

```sh
iptables -P FORWARD DROP # 将 FORWARD 链的默认规则改为 DROP

# -A 添加规则 -p 指定协议 --dport 指定端口 -j 指定规则
iptables -A INPUT -p tcp --dport 17500 -j REJECT --reject-with icmp-port-unreachable

# -R 替换 INPUT 链1 的规则
iptables -R INPUT 1 -p tcp --dport 17500 ! -s 10.0.0.85 -j REJECT --reject-with icmp-port-unreachable

# -I 在链前插入规则 -m 指定注释
iptables -I INPUT -p tcp --dport 17500 -s 10.0.0.85 -j ACCEPT -m comment --comment "Friendly Dropbox"

# 替换 INPUT 链2 的规则
iptables -R INPUT 2 -p tcp --dport 17500 -j REJECT --reject-with icmp-port-unreachable
```

### 保存规则

因为不会自动保存规则，因此需要手动保存

```sh
iptables-save > /etc/iptables/iptables.rules
```

修改后需要重新加载服务

```sh
systemtcl reload iptables

# 或通过 iptables 直接加载
iptables-restore < /etc/iptables/iptables.rules
```

## 规则配置文件

默认存放路径 `/etc/iptables/iptables.rules` 它们不会自动加载，需要启动 `iptables.service`

```sh
systemtcl enable iptables.service
systemtcl start iptables.service
```
